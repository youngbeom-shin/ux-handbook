---
layout: handbook-page-toc
title: "Step by Step Guide to Make Code Changes"
description: "This is a step-by-step guide for how to make code changes against the main GitLab codebase. This guide is meant to serve as a tutorial for anyone with semi-technical knowledge."
---

## 这是什么？

这是一个关于如何对 GitLab 主代码库进行代码修改的分步指南。本指南的目的是为任何具有半技术知识的人提供一个后续教程，让他们通过对用户界面的小改动（如文字改动）为 GitLab 做出贡献。这些修改是有意义的贡献，有助于提高 GitLab 的用户界面的一致性。

这些修改是为 GitLab 项目增加价值的绝佳方式，对于那些想熟悉 GitLab 代码库并在将来做更多有意义的修改的人来说，可以作为很好的入门级 MR。

本指南基于[这个视频教程](https://www.youtube.com/watch?v=AEv3XFw0xJQ)，由[`@jj-ramirez`](https://gitlab.com/jj-ramirez)编写。

## 前提条件

在开始学习本指南之前，请确保您已经安装并运行了 GDK。您可以在下面几页中遵循 GDK 的安装和设置步骤。

- [了解如何准备您的设备以运行GDK](https://gitlab.com/gitlab-org/gitlab-development-kit/-/blob/master/doc/prepare.md)
- [了解如何运行GDK](https://gitlab.com/gitlab-org/gitlab-development-kit/-/blob/master/doc/set-up-gdk.md)
- [GDK命令备忘单](https://gitlab.com/gitlab-org/gitlab-development-kit/-/blob/master/HELP)

**注意：**安装完 GDK 后，你应该有一个`gitlab-development-kit`文件夹（这是默认名称，但如果你在安装过程中修改了名称，它可能会有所不同）。在这个文件夹中，你应该有一个工作的 `gitlab` 文件夹，其中包含 GitLab 项目的所有文件。如果你正确安装了 GDK，这两个文件夹都应该是可用的，可以浏览的。

你还需要安装 Visual Studio Code，因为这是我们在本教程中要使用的代码编辑器。你可以在以下页面下载最新版本的 Visual Studio Code。

- [Visual Studio Code](https://code.visualstudio.com/Download)

最后，您需要在机器中正确地设置 Git 和 SSH 凭证。如果你还没有在你的计算机上配置 SSH 访问，你可以通过完成下面的教程中解释的配置来实现:

- [设置SSH访问](https://docs.gitlab.com/ee/ssh/)



## 一步一步的指导

1. 从你的 Visual Studio Code 中打开`gitlab`文件夹。你可以通过 "文件">"打开"，并在 `gitlab-development-kit` 或同等的GDK目录下找到你的 `gitlab` 文件夹。

1. 打开终端。一个终端或命令行，在所有主要的操作系统中都可用。本指南是在MacOS上编写的，所以我们将在所有示例中使用 Terminal。在“应用程序”文件夹中可以找到MacOS终端。

1. 在终端中导航到你的 `gitlab` 文件夹。你可以通过使用 `cd` 命令来进入文件夹的方式来做到这一点。快速跳转到 `gitlab` 文件夹的一个简单的方法是在 Finder 窗口中定位，并将其拖放到终端上。这个方法将提供 `gitlab` 文件夹所在的绝对路径。

    要做到这一点，只需在你的终端输入 `cd` 。在Finder窗口中找到 `gitlab` 文件夹，并将其拖放到终端上。这样的命令看起来就像这样  `cd /Users/jj-gitlab/Desktop/GDK/gdk2/gitlab` 。点击 `Enter`，你就应该在正确的文件夹里了。您可以通过在终端中检查文件夹的名称与您的机器名称一起出现来确保这是正确的。

1. 运行 `GDK Start` 命令启动您的GDK。这将在您安装 GDK 时设置的测试主机上运行一个本地版本的 GitLab，或者通常在您的本地主机上:http://127.0.0.1:3000/

1. 如果一切正常，您应该能够在浏览器中看到 GitLab 实例的登录页面。使用 GDK 证书登录。您可以在终端中键入 `gdk help` 来找到 GDK 凭证。凭证可以在结果消息的底部找到。

1. 准备好Git，以便准备好后可以开始推送更改。您要做的第一件事是创建并切换到一个新的分支。你可以在你的终端中输入以下命令: `git checkout -b "your-branch-name"`。对于你的分支名称，请确保选择一个有意义和简短的名称。分支名称应该使用连字符，例：('a-branch-name')。

1. 一旦签出到一个新的分支，就是时候开始探索一些潜在的变化了。本指南主要关注UI文本的变化，所以我们将在本指南的其余部分使用一个例子。在本指南中，我们将修改一般设置中的文本，特别是在 "命名、主题、头像 "部分。

    文本是 `更新你的项目名称、主题、描述和头像` 。我们将把这段文字改为 `更新你的项目名称、主题、描述、合规性框架和头像。` 请记住，这只是教程中的一个例子，实际的变化不会被永久推送。

   请确保在您的GDK环境中检查是否存在这一特定文本。为此，请进入其中一个示例项目，点击设置，然后点击常规。第一部分的辅助文本是我们要修改的内容。


1. 现在，我们有了一个明确的目标，我们要修改什么，是时候找到需要修改的文件，以便完成修改。要做到这一点，请进入到 Visual Studio Code，并单击 Visual Studio Code 窗口左侧栏上的全局搜索图标。这将显示一个文本框，您可以在其中键入搜索查询。在这个特定的情况下，我们正在搜索一个特定的字符串，即 `更新您的项目名称，主题，描述和头像`。简单地复制并粘贴该行到搜索框中。

    此时，您应该会看到一些匹配您的查询的搜索结果。由于本指南关注的是如何修改 UI 字符串，这里有一些通用规则来确保你确实修改了该文本的展示:

    - 不要修改任何 `gitlab.pot` 文件。这些转译文件是为了在本指南后面运行 创建 和 更新 任务而创建的

    - 你的字符串可能位于 `.haml`（服务器模板）文件或 `.vue` （前端组件）文件中。无论哪个文件被修改，最可能的情况是，你的目标字符串被包裹在 markdown 中，看起来像这样的 `_('string’)` 或像这样的 `s_('string’)` 。在这个例子中，我们要找的文本应该是这样的 `_('更新你的项目名称、主题、描述和头像。’)` 

    - 你的搜索查询可能出现在测试文件中。测试文件以 `.spec.rb` 或 `.spec.js` 结尾。如果你的字符串与一个测试文件相匹配，那么很可能该测试文件需要被修改。如果这些测试文件没有被修改，当你推送修改时，你的流水线将会失败。这一点将在本指南的 **Caveats** 部分得到更好的解释。

1. 现在我们有了一些关于如何修改用户界面字符串的规则，是时候进行实际的修改了。在这一步之前，我们搜索了`更新你的项目名称、主题、描述和头像`。这应该会在一个名为 `edit.html.haml` 的文件内返回一个匹配。这个文件也符合之前描述的所有条件。它是一个 `.haml` 文件，匹配的字符串被包裹在一个字符串装饰器`_()`中。

1. 现在我们找到了匹配的内容，让我们把 `更新你的项目名称、主题、描述、合规框架和头像` 的文本对调一下，然后保存文件。如果你回到浏览器中运行的 GDK，并刷新页面，你应该看到 UI 中反映的变化。

1. 我们已经在UI中完成了一个修改，现在是时候通过在打开一个MR之前做一些准备任务来结束它: 

    - **在你的终端运行转译工作**。这是一个用你的字符串变化更新转译文件的过程。要做到这一点，只需在你的终端中复制并粘贴这个命令 `bin/rake gettext:regenerate`。这将重新生成前面提到的 `gitlab.pot` 文件。请记住，这项工作可能需要几分钟，终端不会立即给你反馈，所以要有耐心。
    
    - **添加变更日志：**变更日志是对变更内容的简要解释。更新日志是通过一个交互式的命令提示生成的，可以用以下命令从终端启动 `bin/changelog 'Your changelog message'` 。输入这个命令后，只需按照终端的提示操作即可。

1. 最后，我们准备在 GitLab 的主分支上用这个改动打开一个 MR。不用担心这一步。你不会破坏任何东西，而且你的 MR 可以在不影响主分支的情况下被关闭。要推送你的改动，你要做两件事。

   -  在你的终端输入以下git命令:
    - `git add .` 这个命令将添加你刚刚修改的文件，以便它们可以被提交。
    - `git commit -m 'A meaningful message'` 这条命令将创建一个包含您的修改的提交。遵守提交信息的规则是非常重要的，否则你的流水线会失败。为了遵守规则，请确保你的提交信息至少有三个字，但不超过75个字符，第一个字母需要大写，并且不能以句号". "结尾。
    - `git push --set-upstream origin your-branch-name` 该命令将创建一个上游分支，并将你的修改推送到该远程分支。推送完成后，终端会显示 MR 的链接，你可以在浏览器中打开，以最终完成你的修改。

1.你已经完成了!只要确保您将所有最后的细节添加到您的MR中，包括一个里程碑和一个 [type label](/handbook/engineering/metrics/#data-classification)


## 注意事项

### 绑定到测试的字符串

上面的例子显示了一个没有测试的文本字符串的过程。尽管许多UI字符串没有与任何特定的测试相联系（因此不需要修改规范文件），但有一些测试断言可以检查 UI 文本。通常这些测试所做的是通过读取一个元素的内部文本来验证一个特定UI组件的存在。

如果您更改了一个绑定到测试的 UI 字符串，并且没有修改规范文件中的文本，那么测试将失败，因为它再也无法定位该字符串了。

如果你要修改的文本也出现在VS Code搜索结果中的`.spec.js`或`.spec.rb`文件中，你就可以知道你要修改的文本是否与测试有关。

一般来说，你只需要将规范文件中的旧文本与新文本对调，就可以通过测试。然而，在少数情况下，交换文本可能需要对规范文件进行一些额外的修改，但这种情况很少。

### 找到通用的字符串

上面的例子显示了一个非常具体的文本字符串的过程。非常具体的字符串很容易找到和定位，因为在整个应用程序中很可能只有一个该文本的实例。但是，像一些按钮里面的文本这样的通用字符串，例如 "扩展"，又该如何处理呢？

对于那些需要替换通用字符串的情况，你可能需要做一些逻辑思考来确定正确的文件和文本实例。

一个好的策略是在通用字符串附近找到一个非常特定的文本字符串。如果您搜索特定的字符串，您可能会在包含其他文本的模板或组件文件中找到它。一旦你找到了文件，你可以执行搜索范围的文件按 `CMD + F` ，并搜索该文件内的通用字符串。最有可能的是，该文件中的任何结果都是对您试图更改的文本的正确引用。但是，始终要验证您的更改确实通过检查运行的GDK环境得到了反映。

